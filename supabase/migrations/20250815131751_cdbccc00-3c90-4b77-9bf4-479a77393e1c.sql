-- Clean up existing test data in correct order to handle foreign keys
UPDATE public.reservations SET converted_agreement_id = NULL WHERE converted_agreement_id IS NOT NULL;
DELETE FROM public.agreements WHERE agreement_no LIKE 'AGR-%' OR id::text LIKE '950e8400-e29b-41d4-a716-4466554404%';
DELETE FROM public.reservations WHERE ro_number LIKE 'RES-%' OR id::text LIKE '850e8400-e29b-41d4-a716-4466554404%';
DELETE FROM public.vehicles WHERE license_plate IN ('ABC123', 'DEF456', 'GHI789', 'JKL012', 'MNO345', 'PQR678', 'STU901', 'VWX234');
DELETE FROM public.categories WHERE name IN ('Economy', 'Compact', 'Intermediate', 'Standard', 'SUV') AND id::text LIKE '650e8400-e29b-41d4-a716-4466554404%';
DELETE FROM public.customers WHERE email LIKE '%@email.com' AND id::text LIKE '550e8400-e29b-41d4-a716-4466554404%';

-- Insert test customers
INSERT INTO public.customers (id, full_name, email, phone, license_number, date_of_birth, license_expiry, address, emergency_contact, credit_rating, total_rentals, total_spent, notes) VALUES
('550e8400-e29b-41d4-a716-446655440001', 'John Smith', 'john.smith@email.com', '+1-555-0101', 'D1234567', '1985-03-15', '2026-03-15', '{"street": "123 Main St", "city": "Downtown", "state": "CA", "zip": "90210"}', '{"name": "Jane Smith", "phone": "+1-555-0102", "relationship": "spouse"}', 8, 12, 8500.00, 'Frequent business traveler'),
('550e8400-e29b-41d4-a716-446655440002', 'Sarah Johnson', 'sarah.j@email.com', '+1-555-0201', 'D2345678', '1990-07-22', '2025-12-01', '{"street": "456 Oak Ave", "city": "Midtown", "state": "CA", "zip": "90211"}', '{"name": "Mike Johnson", "phone": "+1-555-0202", "relationship": "husband"}', 9, 8, 6200.00, 'Corporate account holder'),
('550e8400-e29b-41d4-a716-446655440003', 'Michael Chen', 'mike.chen@email.com', '+1-555-0301', 'D3456789', '1988-11-05', '2026-11-05', '{"street": "789 Pine Rd", "city": "Uptown", "state": "CA", "zip": "90212"}', '{"name": "Lisa Chen", "phone": "+1-555-0302", "relationship": "wife"}', 7, 15, 12300.00, 'Premium customer'),
('550e8400-e29b-41d4-a716-446655440004', 'Emily Davis', 'emily.davis@email.com', '+1-555-0401', 'D4567890', '1992-01-18', '2025-10-15', '{"street": "321 Elm St", "city": "Westside", "state": "CA", "zip": "90213"}', '{"name": "Tom Davis", "phone": "+1-555-0402", "relationship": "brother"}', 6, 5, 3800.00, 'Weekend traveler'),
('550e8400-e29b-41d4-a716-446655440005', 'Robert Wilson', 'robert.w@email.com', '+1-555-0501', 'D5678901', '1975-09-30', '2026-09-30', '{"street": "654 Maple Dr", "city": "Eastside", "state": "CA", "zip": "90214"}', '{"name": "Mary Wilson", "phone": "+1-555-0502", "relationship": "spouse"}', 9, 25, 18900.00, 'VIP customer');

-- Insert test vehicle categories
INSERT INTO public.categories (id, name, description, icon, example_models) VALUES
('650e8400-e29b-41d4-a716-446655440001', 'Economy', 'Fuel-efficient compact cars', 'car', ARRAY['Nissan Versa', 'Hyundai Accent', 'Mitsubishi Mirage']),
('650e8400-e29b-41d4-a716-446655440002', 'Compact', 'Small to mid-size vehicles', 'car', ARRAY['Honda Civic', 'Toyota Corolla', 'Nissan Sentra']),
('650e8400-e29b-41d4-a716-446655440003', 'Intermediate', 'Mid-size comfortable sedans', 'car', ARRAY['Toyota Camry', 'Honda Accord', 'Nissan Altima']),
('650e8400-e29b-41d4-a716-446655440004', 'Standard', 'Full-size sedans', 'car', ARRAY['Chevrolet Impala', 'Chrysler 300', 'Toyota Avalon']),
('650e8400-e29b-41d4-a716-446655440005', 'SUV', 'Sport Utility Vehicles', 'truck', ARRAY['Honda CR-V', 'Toyota RAV4', 'Nissan Rogue']);

-- Insert test vehicles
INSERT INTO public.vehicles (id, vin, make, model, year, license_plate, category_id, status, fuel_level, odometer, location, color, transmission, engine_size, features, daily_rate, weekly_rate, monthly_rate, subtype, ownership_type) VALUES
('750e8400-e29b-41d4-a716-446655440001', '1HGBH41JXMN109186', 'Honda', 'Civic', 2023, 'ABC123', '650e8400-e29b-41d4-a716-446655440002', 'available', 95, 15200, 'Downtown Branch', 'Silver', 'Automatic', '2.0L', ARRAY['Bluetooth', 'Backup Camera', 'AC'], 45.00, 280.00, 1050.00, 'Sedan', 'Owned'),
('750e8400-e29b-41d4-a716-446655440002', '2T1BURHE0JC123456', 'Toyota', 'Corolla', 2022, 'DEF456', '650e8400-e29b-41d4-a716-446655440002', 'available', 88, 22300, 'Airport Location', 'White', 'CVT', '1.8L', ARRAY['Bluetooth', 'Lane Assist', 'AC'], 42.00, 260.00, 980.00, 'Sedan', 'Owned'),
('750e8400-e29b-41d4-a716-446655440003', '1N4AL3AP8JC234567', 'Nissan', 'Altima', 2024, 'GHI789', '650e8400-e29b-41d4-a716-446655440003', 'available', 92, 8900, 'Midtown Branch', 'Black', 'Automatic', '2.5L', ARRAY['Navigation', 'Heated Seats', 'Sunroof'], 55.00, 340.00, 1280.00, 'Sedan', 'Leased'),
('750e8400-e29b-41d4-a716-446655440004', '4T1BF1FK8JU345678', 'Toyota', 'Camry', 2023, 'JKL012', '650e8400-e29b-41d4-a716-446655440003', 'available', 78, 18700, 'Downtown Branch', 'Red', 'Automatic', '2.5L', ARRAY['Apple CarPlay', 'Wireless Charging', 'Safety Sense'], 58.00, 365.00, 1380.00, 'Sedan', 'Owned'),
('750e8400-e29b-41d4-a716-446655440005', '5NPE34AF8JH456789', 'Hyundai', 'Tucson', 2023, 'MNO345', '650e8400-e29b-41d4-a716-446655440005', 'available', 85, 12400, 'Westside Branch', 'Blue', 'Automatic', '2.5L', ARRAY['AWD', 'Panoramic Roof', 'Smart Cruise'], 75.00, 470.00, 1780.00, 'SUV', 'Owned'),
('750e8400-e29b-41d4-a716-446655440006', '2HKRM4H75JH567890', 'Honda', 'CR-V', 2022, 'PQR678', '650e8400-e29b-41d4-a716-446655440005', 'available', 91, 25600, 'Airport Location', 'Gray', 'CVT', '1.5L Turbo', ARRAY['Honda Sensing', 'Remote Start', 'Roof Rails'], 72.00, 450.00, 1700.00, 'SUV', 'Leased'),
('750e8400-e29b-41d4-a716-446655440007', 'JTDBF4K16HJ678901', 'Toyota', 'RAV4', 2024, 'STU901', '650e8400-e29b-41d4-a716-446655440005', 'available', 96, 5200, 'Eastside Branch', 'Green', 'Automatic', '2.5L', ARRAY['AWD', 'Power Liftgate', 'LED Headlights'], 78.00, 485.00, 1850.00, 'SUV', 'Owned'),
('750e8400-e29b-41d4-a716-446655440008', '3GNAXUEV8JL789012', 'Chevrolet', 'Equinox', 2023, 'VWX234', '650e8400-e29b-41d4-a716-446655440005', 'available', 82, 19800, 'Midtown Branch', 'White', 'Automatic', '1.5L Turbo', ARRAY['Wifi Hotspot', 'Teen Driver', 'Cargo Management'], 68.00, 425.00, 1600.00, 'SUV', 'Owned');

-- Insert test reservations for Aug 26-31, 2025
INSERT INTO public.reservations (id, customer_id, vehicle_id, start_datetime, end_datetime, pickup_location, return_location, status, total_amount, rate_plan, taxes, add_ons, po_number, ro_number, special_requests) VALUES
('850e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440001', '750e8400-e29b-41d4-a716-446655440001', '2025-08-26 09:00:00+00', '2025-08-28 17:00:00+00', 'Downtown Branch', 'Downtown Branch', 'confirmed', 135.00, '{"daily_rate": 45, "days": 3}', '[{"name": "Sales Tax", "rate": 8.5, "amount": 10.59}]', '[{"name": "GPS Navigation", "amount": 15.00}]', 'PO2025001', 'RES-000001', 'Need early pickup at 8 AM'),
('850e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440002', '750e8400-e29b-41d4-a716-446655440003', '2025-08-26 14:00:00+00', '2025-08-30 10:00:00+00', 'Airport Location', 'Midtown Branch', 'confirmed', 275.00, '{"daily_rate": 55, "days": 5}', '[{"name": "Sales Tax", "rate": 8.5, "amount": 21.59}]', '[{"name": "Child Seat", "amount": 25.00}]', 'PO2025002', 'RES-000002', 'Business trip - premium vehicle required'),
('850e8400-e29b-41d4-a716-446655440003', '550e8400-e29b-41d4-a716-446655440003', '750e8400-e29b-41d4-a716-446655440005', '2025-08-27 11:00:00+00', '2025-08-31 15:00:00+00', 'Westside Branch', 'Airport Location', 'pending', 375.00, '{"daily_rate": 75, "days": 5}', '[{"name": "Sales Tax", "rate": 8.5, "amount": 29.41}]', '[{"name": "Additional Driver", "amount": 20.00}, {"name": "Insurance", "amount": 45.00}]', null, 'RES-000003', 'Family vacation - need SUV with space'),
('850e8400-e29b-41d4-a716-446655440004', '550e8400-e29b-41d4-a716-446655440004', '750e8400-e29b-41d4-a716-446655440002', '2025-08-28 16:00:00+00', '2025-08-29 12:00:00+00', 'Airport Location', 'Airport Location', 'confirmed', 84.00, '{"daily_rate": 42, "days": 2}', '[{"name": "Sales Tax", "rate": 8.5, "amount": 6.58}]', '[]', null, 'RES-000004', 'Quick weekend trip'),
('850e8400-e29b-41d4-a716-446655440005', '550e8400-e29b-41d4-a716-446655440005', '750e8400-e29b-41d4-a716-446655440007', '2025-08-29 08:00:00+00', '2025-08-31 20:00:00+00', 'Eastside Branch', 'Eastside Branch', 'checked_out', 234.00, '{"daily_rate": 78, "days": 3}', '[{"name": "Sales Tax", "rate": 8.5, "amount": 18.34}]', '[{"name": "Roadside Assistance", "amount": 12.00}]', 'PO2025005', 'RES-000005', 'VIP customer - ensure premium service');

-- Insert test agreements for Aug 26-31, 2025  
INSERT INTO public.agreements (id, reservation_id, customer_id, vehicle_id, agreement_date, checkout_datetime, return_datetime, checkout_fuel, checkout_odometer, return_fuel, return_odometer, status, total_amount, agreement_no, notes) VALUES
('950e8400-e29b-41d4-a716-446655440001', '850e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440001', '750e8400-e29b-41d4-a716-446655440001', '2025-08-26 09:00:00+00', '2025-08-26 09:15:00+00', '2025-08-28 17:30:00+00', 95, 15200, 88, 15450, 'completed', 135.00, 'AGR-000001', 'Customer satisfied with service'),
('950e8400-e29b-41d4-a716-446655440002', '850e8400-e29b-41d4-a716-446655440002', '550e8400-e29b-41d4-a716-446655440002', '750e8400-e29b-41d4-a716-446655440003', '2025-08-26 14:00:00+00', '2025-08-26 14:20:00+00', null, 92, 8900, null, null, 'active', 275.00, 'AGR-000002', 'Vehicle checked out for business trip'),
('950e8400-e29b-41d4-a716-446655440003', null, '550e8400-e29b-41d4-a716-446655440004', '750e8400-e29b-41d4-a716-446655440006', '2025-08-27 10:00:00+00', '2025-08-27 10:30:00+00', '2025-08-29 16:00:00+00', 91, 25600, 85, 25890, 'completed', 180.00, 'AGR-000003', 'Walk-in customer - weekend rental'),
('950e8400-e29b-41d4-a716-446655440004', null, '550e8400-e29b-41d4-a716-446655440003', '750e8400-e29b-41d4-a716-446655440008', '2025-08-28 13:00:00+00', '2025-08-28 13:15:00+00', null, 82, 19800, null, null, 'pending_return', 220.00, 'AGR-000004', 'Extended rental - customer may extend further'),
('950e8400-e29b-41d4-a716-446655440005', null, '550e8400-e29b-41d4-a716-446655440005', '750e8400-e29b-41d4-a716-446655440004', '2025-08-30 11:00:00+00', '2025-08-30 11:20:00+00', null, 78, 18700, null, null, 'active', 290.00, 'AGR-000005', 'VIP customer special rate applied');